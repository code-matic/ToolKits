steps: 
- id: pull-env
  name: 'gcr.io/cloud-builders/gsutil'
  args: [
    'cp', 'gs://envs_store_dev/cloudbuild-generator/.env', './generator/.env']
- id: build-image
  name: "gcr.io/cloud-builders/docker"
  args: [
    'build', '-t', 'eu.gcr.io/codematic-shared-environment/cloudbuild-generator-github:$SHORT_SHA', '-f', './codeblock-toolkit/Dockerfile', './'
  ]
- id: push-image
  name: "gcr.io/cloud-builders/docker"
  args: [
    'push',
    'eu.gcr.io/codematic-shared-environment/cloudbuild-generator-github:$SHORT_SHA'
  ]
- id: deploy-image
  name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
  entrypoint: gcloud
  args: [
    'run', 'deploy',
    'cloudbuild-generator-github', '--image', 'eu.gcr.io/codematic-shared-environment/cloudbuild-generator-github:$SHORT_SHA',
    '--region', 'europe-west1', '--allow-unauthenticated', '--cpu=2', '--memory=2Gi', '--cpu-boost', '--timeout=500s'
  ]
